---
title: "BikeShareAnalysis"
author: "Razeen"
date: "2024-03-14"
output: rmarkdown::github_document
---


### Load Packages
```{r}
library(tidyverse)
library(readr)
library(lubridate)
library(ggplot2)
# turn off scientific notations for axis
options(scipen = 999, repr.plot.width = 11, repr.plot.height = 8)
```


Reading CSV files into dataframes
```{r readCSV}
Data202303 <- read_csv('csv_files/202303-divvy-tripdata.csv')
Data202304 <- read_csv('csv_files/202304-divvy-tripdata.csv')
Data202305 <- read_csv('csv_files/202305-divvy-tripdata.csv')
Data202306 <- read_csv('csv_files/202306-divvy-tripdata.csv')
Data202307 <- read_csv('csv_files/202307-divvy-tripdata.csv')
Data202308 <- read_csv('csv_files/202308-divvy-tripdata.csv')
Data202309 <- read_csv('csv_files/202309-divvy-tripdata.csv')
Data202310 <- read_csv('csv_files/202310-divvy-tripdata.csv')
Data202311 <- read_csv('csv_files/202311-divvy-tripdata.csv')
Data202312 <- read_csv('csv_files/202312-divvy-tripdata.csv')
Data202401 <- read_csv('csv_files/202401-divvy-tripdata.csv')
Data202402 <- read_csv('csv_files/202402-divvy-tripdata.csv')

```

Check for columns consistency 
```{r}
str(Data202303)
str(Data202304)
str(Data202305)
str(Data202306)
str(Data202307)
str(Data202308)
str(Data202309)
str(Data202310)
str(Data202311)
str(Data202312)
str(Data202401)
str(Data202402)
```

Since all columns in dataframes are identical, all dataframes can be used to merge together to form a single dataframe.
```{r}
MergedData <- rbind(Data202303, Data202304, Data202305,
                         Data202306, Data202307, Data202308,
                         Data202309, Data202310, Data202311,
                         Data202312, Data202401, Data202402)
```


Check the new dataframe created.
```{r}
head(MergedData)
```

Remove duplicates of ride_id to ensure each ride is unique.
```{r}
NoDupMergedData <- MergedData %>% 
distinct(ride_id, .keep_all = TRUE)
```


create a new column for ride duration as ride_duration by subtracting started_at from ended_at column. This creates a column with ride duration in seconds. 
```{r}
NoDupMergedData <- mutate(NoDupMergedData, ride_duration=ended_at-started_at)
```


create a column for ride duration in minutes and make the type as double. 
```{r}
NoDupMergedData$ride_duration_minutes <- (as.double(difftime(NoDupMergedData$ended_at, NoDupMergedData$started_at))) /60
```


Create a new column for day of the week as day_of_week by extracting the day from started_at column
```{r}
NoDupMergedData <- NoDupMergedData %>% 
  mutate(month = month.name[month(started_at)],
         day_of_week = weekdays(started_at),
         started_hour = hour(started_at))
```



Get summary of the merged dataframe.
```{r}
summary(NoDupMergedData)
```

At this point, all columns required for analysis are created. 

Looking at the summary of the newly created dataframe, it is visible that there are negative values for ride_duration. 
Creating a subset of dataframe with negative ride duration. 

```{r}
negative_duration_df <- subset(NoDupMergedData, ride_duration_minutes < 0)
```

Checking the rows of negative ride duration. The negative ride durations does not make sense.

```{r}
head(negative_duration_df)
```

Create a subset with positive values for ride duration. 
```{r}
PositveNoDupMergedData <- subset(NoDupMergedData, ride_duration_minutes > 0)
```


head dataframe
```{r}
head(PositveNoDupMergedData)
```






get a subset of data to practice graphs
```{r}
datasmall <- PositveNoDupMergedData %>%
  slice(1:2000)
```


#Analysis

user percentage dataframe 
```{r}
user_percentage_summary <- PositveNoDupMergedData %>% 
  group_by(member_casual) %>% 
  summarise(count = n(),  percentage = round(length(ride_id)/nrow(PositveNoDupMergedData)*100,2), 
            .groups = "drop")
```


Total number of rides 
```{r}
ggplot(user_percentage_summary, aes(x = "", y = count, fill = member_casual)) + 
  geom_col() + 
  labs(title = "Number of Rides Taken by User Type (Mar 2023 - Feb 2024)") + 
  geom_text(aes(label = paste(percentage, "%")), position = position_stack(vjust = 0.5), size = 4) + 
  theme_void(base_size = 12) +  # Adjust font size here
  scale_fill_discrete(name = "User Type") + 
  coord_polar(theta = "y") +
  theme(plot.title = element_text(margin = margin(b = 20)))  # Adjust title margin
```




comparison between two types against start hour of the rides. 
```{r}
#ggplot(PositveNoDupMergedData, aes(started_hour, fill=member_casual)) +
#  geom_bar(position="dodge", alpha=0.5)
```

second plot
```{r}
#ggplot(data = PositveNoDupMergedData, aes(x = member_casual, y = ride_duration_minutes, fill = member_casual)) +
#  geom_violin(trim = FALSE) +
#  scale_fill_manual(values = c("blue", "red")) +  # Adjust colors as needed
#  labs(x = "Member Type", y = "Ride Duration (minutes)") +
#  theme_minimal()
```





