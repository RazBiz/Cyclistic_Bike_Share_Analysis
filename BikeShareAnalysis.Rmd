---
title: "BikeShareAnalysis"
author: "Razeen"
date: "2024-03-14"
output: rmarkdown::github_document
---


### Load Packages
```{r}
library(tidyverse)
library(readr)
library(lubridate)
library(ggplot2)
# turn off scientific notations for axis
options(scipen = 999, repr.plot.width = 11, repr.plot.height = 8)
```


Reading CSV files into dataframes
```{r readCSV}
Data202303 <- read_csv('csv_files/202303-divvy-tripdata.csv')
Data202304 <- read_csv('csv_files/202304-divvy-tripdata.csv')
Data202305 <- read_csv('csv_files/202305-divvy-tripdata.csv')
Data202306 <- read_csv('csv_files/202306-divvy-tripdata.csv')
Data202307 <- read_csv('csv_files/202307-divvy-tripdata.csv')
Data202308 <- read_csv('csv_files/202308-divvy-tripdata.csv')
Data202309 <- read_csv('csv_files/202309-divvy-tripdata.csv')
Data202310 <- read_csv('csv_files/202310-divvy-tripdata.csv')
Data202311 <- read_csv('csv_files/202311-divvy-tripdata.csv')
Data202312 <- read_csv('csv_files/202312-divvy-tripdata.csv')
Data202401 <- read_csv('csv_files/202401-divvy-tripdata.csv')
Data202402 <- read_csv('csv_files/202402-divvy-tripdata.csv')

```

Check for columns consistency 
```{r}
str(Data202303)
str(Data202304)
str(Data202305)
str(Data202306)
str(Data202307)
str(Data202308)
str(Data202309)
str(Data202310)
str(Data202311)
str(Data202312)
str(Data202401)
str(Data202402)
```

Since all columns in dataframes are identical, all dataframes can be used to merge together to form a single dataframe.
```{r}
MergedData <- rbind(
  Data202303, Data202304, Data202305,
  Data202306, Data202307, Data202308,
  Data202309, Data202310, Data202311,
  Data202312, Data202401, Data202402
  )
```


Check the new dataframe created.
```{r}
head(MergedData)
```

Remove duplicates of ride_id to ensure each ride is unique.
```{r}
NoDupMergedData <- MergedData %>% 
distinct(ride_id, .keep_all = TRUE)
```


create a new column for ride duration as ride_duration by subtracting started_at from ended_at column. This creates a column with ride duration in seconds. 
```{r}
NoDupMergedData <- mutate(NoDupMergedData, ride_duration=ended_at-started_at)
```


create a column for ride duration in minutes and make the type as double. 
```{r}
NoDupMergedData$ride_duration_minutes <- (as.double(difftime(NoDupMergedData$ended_at, NoDupMergedData$started_at))) /60
```


Create a new column for day of the week as day_of_week by extracting the day from started_at column
```{r}
NoDupMergedData <- NoDupMergedData %>% 
  mutate(month = month.name[month(started_at)],
         day_of_week = weekdays(started_at),
         started_hour = hour(started_at))
```



Get summary of the merged dataframe.
```{r}
summary(NoDupMergedData)
```

At this point, all columns required for analysis are created. 

Looking at the summary of the newly created dataframe, it is visible that there are negative values for ride_duration. 
Creating a subset of dataframe with negative ride duration. 

```{r}
negative_duration_df <- subset(NoDupMergedData, ride_duration_minutes < 0)
```

Checking the rows of negative ride duration. The negative ride durations does not make sense.

```{r}
head(negative_duration_df)
```

Create a subset with positive values for ride duration. 
```{r}
PositiveNoDupMergedData <- subset(NoDupMergedData, ride_duration_minutes > 0)
```


head dataframe
```{r}
head(PositiveNoDupMergedData)
```




get a subset of data to practice graphs
```{r}
datasmall <- PositiveNoDupMergedData %>%
  slice(1:1000000)
```


#Analysis

user percentage dataframe 
Total number of rides 
```{r}
user_percentage_summary <- PositiveNoDupMergedData %>% 
  group_by(member_casual) %>% 
  summarise(count = n(),  percentage = round(length(ride_id)/nrow(PositiveNoDupMergedData)*100,2), 
            .groups = "drop")

ggplot(user_percentage_summary, aes(x = "", y = count, fill = member_casual)) + 
  geom_col() + 
  labs(title = "Rides by User Type (Mar 2023 - Feb 2024)") + 
  geom_text(aes(label = paste(percentage, "%")), position = position_stack(vjust = 0.5), size = 4) + 
  theme_void(base_size = 12) +
  scale_fill_discrete(name = "User Type") + 
  coord_polar(theta = "y") +
  theme(plot.title = element_text(margin = margin(b = 20))) 
```

comparison of months vs rides 
```{r}
PositiveNoDupMergedData$month <- factor(PositiveNoDupMergedData$month, levels = c("March", "April", "May", "June", "July", "August", "September", "October", "November", "December", "January", "February"))

ggplot(PositiveNoDupMergedData, aes(month, fill=member_casual)) +
  geom_bar(position="dodge", alpha=0.5) + 
  labs(title = "Rides by Month (Mar 2023 - Feb 2024)") +
  scale_fill_discrete(name = "User Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Ride preference by day

```{r}
PositiveNoDupMergedData$day_of_week <- factor(PositiveNoDupMergedData$day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))


ggplot(PositiveNoDupMergedData, aes(day_of_week, fill=member_casual)) +
  geom_bar(position="dodge", alpha=0.5) + 
  labs(title = "Rides Preference by Day  of Week (Mar 2023 - Feb 2024)") +
  scale_fill_discrete(name = "User Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


#Weekday Analysis

Getting the number of rides by hours on weekdays
```{r}
count_by_hours_on_weekdays <- PositiveNoDupMergedData %>%
  filter(!(day_of_week %in% c("Saturday", "Sunday")))%>%
  group_by(day_of_week, member_casual, started_hour) %>%
  summarise(count = n(), .groups = "drop")

ggplot(count_by_hours_on_weekdays, aes(x = started_hour, y = count, group = member_casual, 
  color = member_casual)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Ride Count by Hour of Day on Weekdays (Mar 2023 - Feb 2024)", x = "Hour of Day", 
  y = "No. of Rides") + guides(color = guide_legend(title = "User Type")) + 
  theme(plot.title = element_text(margin = margin(b = 20))) +
  facet_wrap(~day_of_week)
```


Bike type preference on weekdays
```{r}
bike_preference_weekdays <- PositiveNoDupMergedData %>%
  filter(!(day_of_week %in% c("Saturday", "Sunday")))%>%
  group_by(day_of_week, rideable_type, started_hour) %>%
  summarise(count = n(), .groups = "drop")

ggplot(bike_preference_weekdays, aes(x = started_hour, y = count, group = rideable_type, 
  color = rideable_type)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Bike type preference by Hour of Day on Weekdays (Mar 2023 - Feb 2024)", x = "Hour of Day", 
  y = "No. of Bikes") + guides(color = guide_legend(title = "Bike Type")) + 
  theme(plot.title = element_text(margin = margin(b = 20))) +
  facet_wrap(~day_of_week) +
  scale_color_manual(values = c("classic_bike" = "yellow", "docked_bike" = "purple", "electric_bike" = "green" ))

```
ride duration (weekday)
```{r}
ride_duration_weekdays <- PositiveNoDupMergedData %>%
  filter(!(day_of_week %in% c("Saturday", "Sunday")))%>%
  group_by(day_of_week, member_casual) %>%
  summarise(avg_ride_duration = mean(ride_duration_minutes), .groups = 'drop')


ggplot(ride_duration_weekdays, aes(day_of_week, avg_ride_duration, fill = member_casual)) +
  geom_bar(position = "dodge", alpha = 0.5, stat = "identity") + 
  labs(title = "Average ride duration by Day on Weekdays (Mar 2023 - Feb 2024)",
       x = "Day of the Week",
       y = "Average Ride Duration") +
  scale_fill_manual(values = c("casual" = "red", "member" = "blue"), name = "User Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```



#Weekend Analysis

Getting the number of rides by hours on weekends
```{r}

count_by_hours_on_weekends <- PositiveNoDupMergedData %>%
  filter(day_of_week %in% c("Saturday", "Sunday")) %>%
  group_by(day_of_week, member_casual, started_hour) %>%
  summarise(count = n(), .groups = "drop")

ggplot(count_by_hours_on_weekends, aes(x = started_hour, y = count, group = member_casual, 
  color = member_casual)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Ride Count by Hour of Day on Weekends (Mar 2023 - Feb 2024)", x = "Hour of Day", 
  y = "No. of Rides") + guides(color = guide_legend(title = "User Type")) + 
  theme(plot.title = element_text(margin = margin(b = 20))) +
  facet_wrap(~day_of_week)

```

Bike type preference on weekend
```{r}
bike_preference_weekend <- PositiveNoDupMergedData %>%
  filter(day_of_week %in% c("Saturday", "Sunday"))%>%
  group_by(day_of_week, rideable_type, started_hour) %>%
  summarise(count = n(), .groups = "drop")

ggplot(bike_preference_weekend, aes(x = started_hour, y = count, group = rideable_type, 
  color = rideable_type)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Bike type preference by Hour of Day on Weekends (Mar 2023 - Feb 2024)", x = "Hour of Day", 
  y = "No. of Bikes") + guides(color = guide_legend(title = "Bike Type")) + 
  theme(plot.title = element_text(margin = margin(b = 20))) +
  facet_wrap(~day_of_week) +
  scale_color_manual(values = c("classic_bike" = "yellow", "docked_bike" = "purple", "electric_bike" = "green" ))
```


ride duration (weekend)
```{r}
ride_duration_weekend <- PositiveNoDupMergedData %>%
  filter(day_of_week %in% c("Saturday", "Sunday"))%>%
  group_by(day_of_week, member_casual) %>%
  summarise(avg_ride_duration = mean(ride_duration_minutes), .groups = 'drop')


ggplot(ride_duration_weekend, aes(day_of_week, avg_ride_duration, fill = member_casual)) +
  geom_bar(position = "dodge", alpha = 0.5, stat = "identity") + 
  labs(title = "Average ride duration by Day on weekends (Mar 2023 - Feb 2024)",
       x = "Day of the Week",
       y = "Average Ride Duration") +
  scale_fill_manual(values = c("casual" = "red", "member" = "blue"), name = "User Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```






